---
# Homepage Services Configuration
# Redesign v2.0.0 - Organized by operational priority

# ============================================================================
# CLUSTER HEALTH - Immediate visibility of cluster state
# ============================================================================
- Cluster Health:
    - Cluster Alerts:
        icon: mdi-alert-circle
        href: https://grafana.chocolandiadc.com/alerting/groups
        description: "Active Prometheus alerts"
        widget:
          type: prometheusmetric
          url: http://kube-prometheus-stack-prometheus.monitoring.svc.cluster.local:9090
          refreshInterval: 30000
          metrics:
            - label: Critical
              query: count(ALERTS{alertstate="firing", severity="critical"}) or vector(0)
              format:
                type: number
            - label: Warning
              query: count(ALERTS{alertstate="firing", severity="warning"}) or vector(0)
              format:
                type: number

    - CoreDNS:
        icon: mdi-kubernetes
        href: https://headlamp.chocolandiadc.com
        description: "K3s cluster DNS"
        widget:
          type: kubernetes
          cluster: default
          namespace: kube-system
          podSelector: k8s-app=kube-dns

    - Metrics Server:
        icon: mdi-server-network
        description: "Cluster metrics (CPU/MEM)"
        widget:
          type: kubernetes
          cluster: default
          namespace: kube-system
          podSelector: k8s-app=metrics-server

    - Ingress Health:
        icon: traefik.svg
        href: https://traefik.chocolandiadc.com
        description: "Traefik ingress (LB: 192.168.4.202)"
        widget:
          type: kubernetes
          cluster: default
          namespace: traefik
          app: traefik
          podSelector: app.kubernetes.io/name=traefik

# ============================================================================
# CRITICAL INFRASTRUCTURE - Services that break others when down
# ============================================================================
- Critical Infrastructure:
    - Traefik:
        icon: traefik.svg
        href: https://traefik.chocolandiadc.com
        description: "Reverse proxy | LB: 192.168.4.202"
        widget:
          type: kubernetes
          cluster: default
          namespace: traefik
          app: traefik
          podSelector: app.kubernetes.io/name=traefik

    - Pi-hole:
        icon: si-pihole
        href: https://pihole.chocolandiadc.com
        description: "Network DNS | LB: 192.168.4.200:53"
        widget:
          type: kubernetes
          cluster: default
          namespace: default
          podSelector: app=pihole

    - PostgreSQL:
        icon: si-postgresql
        description: "Database | LB: 192.168.4.204:5432"
        widget:
          type: kubernetes
          cluster: default
          namespace: postgresql
          app: postgres
          podSelector: app.kubernetes.io/name=postgres

    - Redis:
        icon: si-redis
        description: "Cache | LB: 192.168.4.203:6379"
        widget:
          type: kubernetes
          cluster: default
          namespace: redis
          app: redis
          podSelector: app.kubernetes.io/name=redis

# ============================================================================
# PLATFORM SERVICES - Operational and observability tools
# ============================================================================
- Platform Services:
    - ArgoCD:
        icon: argocd.svg
        href: https://argocd.chocolandiadc.com
        description: "GitOps CD | NodePort: 30080"
        widget:
          type: kubernetes
          cluster: default
          namespace: argocd
          app: argocd-server
          podSelector: app.kubernetes.io/name=argocd-server

    - Grafana:
        icon: grafana.svg
        href: https://grafana.chocolandiadc.com
        description: "Dashboards | NodePort: 30000"
        widget:
          type: kubernetes
          cluster: default
          namespace: monitoring
          app: grafana
          podSelector: app.kubernetes.io/name=grafana

    - Headlamp:
        icon: kubernetes-dashboard.svg
        href: https://headlamp.chocolandiadc.com
        description: "K8s Web UI"
        widget:
          type: kubernetes
          cluster: default
          namespace: headlamp
          app: headlamp
          podSelector: app.kubernetes.io/name=headlamp

    - cert-manager:
        icon: cert-manager.svg
        description: "TLS certificates"
        widget:
          type: kubernetes
          cluster: default
          namespace: cert-manager
          app: cert-manager
          podSelector: app.kubernetes.io/name=cert-manager

# ============================================================================
# APPLICATIONS - User-facing workloads
# ============================================================================
- Applications:
    - Beersystem:
        icon: si-beer
        href: https://beer.chocolandiadc.com
        description: "Beer inventory | Private: 192.168.4.101:3001"
        siteMonitor: https://beer.chocolandiadc.com
        widget:
          type: kubernetes
          cluster: default
          namespace: beersystem
          podSelector: app=beersystem,component=backend

    - Homepage:
        icon: homepage.svg
        href: https://homepage.chocolandiadc.com
        description: "This dashboard"
        widget:
          type: kubernetes
          cluster: default
          namespace: homepage
          podSelector: app=homepage

    - Paperless-ngx:
        icon: paperless.svg
        href: https://paperless.chocolandiadc.com
        description: "Document management | SMB: 192.168.4.201"
        siteMonitor: https://paperless.chocolandiadc.com
        widget:
          type: kubernetes
          cluster: default
          namespace: paperless
          podSelector: app.kubernetes.io/name=paperless-ngx

    - Home Assistant:
        icon: home-assistant.svg
        href: https://homeassistant.chocolandiadc.com
        description: "Smart home automation"
        siteMonitor: https://homeassistant.chocolandiadc.com
        widget:
          type: kubernetes
          cluster: default
          namespace: home-assistant
          podSelector: app.kubernetes.io/name=home-assistant

    - Prometheus:
        icon: si-prometheus
        description: "Metrics DB | kubectl port-forward -n monitoring svc/kube-prometheus-stack-prometheus 9090:9090"
        widget:
          type: prometheus
          url: http://kube-prometheus-stack-prometheus.monitoring.svc.cluster.local:9090

# ============================================================================
# STORAGE & DATA - Persistence layer
# ============================================================================
- Storage & Data:
    - Longhorn:
        icon: si-cncf
        href: https://longhorn.chocolandiadc.com
        description: "Distributed block storage"
        widget:
          type: kubernetes
          cluster: default
          namespace: longhorn-system
          app: longhorn
          podSelector: app=longhorn-ui

    - MinIO Console:
        icon: si-minio
        href: https://minio.chocolandiadc.com
        description: "S3 object storage | Private: 192.168.4.101:9001"
        widget:
          type: kubernetes
          cluster: default
          namespace: minio
          app: minio
          podSelector: app=minio

    - MinIO S3 API:
        icon: mdi-api
        href: http://s3.chocolandiadc.com
        description: "S3 API endpoint (Pi-hole DNS)"

# ============================================================================
# QUICK REFERENCE - Commands, IPs, and access patterns
# ============================================================================
- Quick Reference:
    - SSH Access:
        icon: mdi-console
        description: |
          master1: ssh -i ~/.ssh/id_ed25519_k3s chocolim@192.168.4.101
          nodo1: ssh -i ~/.ssh/id_ed25519_k3s chocolim@192.168.4.102
          nodo03: ssh -i ~/.ssh/id_ed25519_k3s chocolim@192.168.4.103
          nodo04: ssh -i ~/.ssh/id_ed25519_k3s chocolim@192.168.4.104

    - Port Forwards:
        icon: mdi-transit-connection-variant
        description: |
          Prometheus: kubectl port-forward -n monitoring svc/kube-prometheus-stack-prometheus 9090:9090
          Alertmanager: kubectl port-forward -n monitoring svc/kube-prometheus-stack-alertmanager 9093:9093

    - MetalLB IPs:
        icon: mdi-ip-network
        description: |
          192.168.4.200 → Pi-hole DNS
          192.168.4.202 → Traefik Ingress
          192.168.4.203 → Redis
          192.168.4.204 → PostgreSQL
          Range: 192.168.4.200-210

    - Certificates:
        icon: mdi-certificate
        description: |
          Public: letsencrypt-production (*.chocolandiadc.com)
          Private: local-ca (*.chocolandiadc.local)
          CA cert: terraform/environments/chocolandiadc-mvp/chocolandia-local-ca.crt

    - Common Commands:
        icon: mdi-code-tags
        description: |
          kubectl get pods -A | grep -v Running
          kubectl top nodes && kubectl top pods -A
          kubectl get events -A --sort-by='.lastTimestamp' | tail -20
